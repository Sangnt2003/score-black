<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ghi ƒêi·ªÉm B√†i Ti·∫øn L√™n</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 100%;
        margin: 0 auto;
        padding: 15px;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 20px;
      }

      .header h1 {
        font-size: 2rem;
        margin-bottom: 8px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1rem;
        opacity: 0.9;
      }

      .main-content {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .game-area {
        background: white;
        border-radius: 20px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        order: 1;
      }

      .sidebar {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        order: 2;
      }

      .card {
        background: white;
        border-radius: 12px;
        padding: 15px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }

      .card h3 {
        font-size: 1.1rem;
        margin-bottom: 12px;
        color: #667eea;
      }

      .setup-section {
        margin-bottom: 20px;
      }

      .setup-section h3 {
        color: #667eea;
        margin-bottom: 12px;
        font-size: 1.2rem;
      }

      .input-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 12px;
        align-items: stretch;
      }

      .input-group label {
        font-weight: 600;
        font-size: 0.9rem;
      }

      input,
      select,
      button {
        padding: 12px 15px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.3s ease;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      button {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: transform 0.2s ease;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      button:active {
        transform: translateY(0);
      }

      .btn-secondary {
        background: linear-gradient(135deg, #f093fb, #f5576c);
      }

      .btn-success {
        background: linear-gradient(135deg, #4facfe, #00f2fe);
      }

      .btn-danger {
        background: linear-gradient(135deg, #fa709a, #fee140);
      }

      .players-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .player-card {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        border: 3px solid transparent;
        transition: all 0.3s ease;
      }

      .player-card.winner {
        border-color: #28a745;
        background: linear-gradient(135deg, #d4edda, #c3e6cb);
      }

      .player-card.loser {
        border-color: #dc3545;
        background: linear-gradient(135deg, #f8d7da, #f5c6cb);
      }

      .player-name {
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
      }

      .player-score {
        font-size: 2rem;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 15px;
      }

      .score-input {
        width: 100%;
        text-align: center;
        margin: 5px 0;
        font-size: 16px;
        padding: 12px;
      }

      .round-history {
        max-height: 400px;
        overflow-y: auto;
      }

      .round-item {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        border-left: 4px solid #667eea;
      }

      .round-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .round-number {
        font-weight: bold;
        color: #667eea;
      }

      .round-scores {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 10px;
        font-size: 0.9rem;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        text-align: center;
      }

      .stat-item {
        padding: 12px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border-radius: 8px;
      }

      .stat-value {
        font-size: 1.3rem;
        font-weight: bold;
      }

      .stat-label {
        font-size: 0.8rem;
        opacity: 0.9;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal.show {
        display: flex;
      }

      .modal-content {
        background: white;
        border-radius: 15px;
        padding: 20px;
        max-width: 95vw;
        width: 100%;
        text-align: center;
        max-height: 90vh;
        overflow-y: auto;
      }

      .number-pad {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        margin: 15px 0;
        max-width: 280px;
        margin-left: auto;
        margin-right: auto;
      }

      .number-btn {
        padding: 12px;
        font-size: 18px;
        font-weight: bold;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        background: white;
        color: #333;
        cursor: pointer;
        transition: all 0.2s ease;
        min-height: 48px;
        touch-action: manipulation;
      }

      .number-btn:hover {
        background: #667eea;
        color: white;
        border-color: #667eea;
        transform: scale(1.05);
      }

      .number-btn.negative {
        background: #ff6b6b;
        color: white;
        border-color: #ff6b6b;
      }

      .number-btn.negative:hover {
        background: #ff5252;
        border-color: #ff5252;
      }

      .number-btn.zero {
        background: #f8f9fa;
      }

      .number-btn.clear {
        background: #ffa726;
        color: white;
        border-color: #ffa726;
      }

      .number-btn.clear:hover {
        background: #ff9800;
        border-color: #ff9800;
      }

      .active-input {
        border: 3px solid #667eea !important;
        box-shadow: 0 0 10px rgba(102, 126, 234, 0.3) !important;
      }

      .emoji {
        font-size: 3rem;
        margin-bottom: 20px;
      }

      .hidden {
        display: none;
      }

      @media (max-width: 768px) {
        .players-grid {
          grid-template-columns: 1fr 1fr;
          gap: 8px;
        }

        .header h1 {
          font-size: 1.8rem;
        }

        .sidebar {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .number-pad {
          grid-template-columns: repeat(3, 1fr);
          gap: 6px;
          max-width: 220px;
        }

        .number-btn {
          padding: 10px;
          font-size: 16px;
          min-height: 44px;
        }

        .game-area {
          padding: 15px;
        }

        .modal-content {
          padding: 15px;
        }
      }

      @media (max-width: 480px) {
        .players-grid {
          grid-template-columns: 1fr;
        }

        .player-card {
          padding: 12px;
        }

        .player-score {
          font-size: 1.5rem;
        }

        .container {
          padding: 10px;
        }
      }

      .shuffle-animation {
        animation: shuffle 0.5s ease-in-out;
      }

      @keyframes shuffle {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üé¥ Ghi ƒêi·ªÉm B√†i Ti·∫øn L√™n</h1>
        <p>Ghi ƒëi·ªÉm nhanh ch√≥ng v√† ti·ªán l·ª£i cho tr√≤ ch∆°i ti·∫øn l√™n</p>
      </div>

      <div class="main-content">
        <div class="game-area">
          <div id="setupSection" class="setup-section">
            <h3>üéÆ Thi·∫øt L·∫≠p Game</h3>
            <div class="input-group">
              <label>S·ªë ng∆∞·ªùi ch∆°i:</label>
              <select id="playerCount">
                <option value="2">2 ng∆∞·ªùi</option>
                <option value="3">3 ng∆∞·ªùi</option>
                <option value="4" selected>4 ng∆∞·ªùi</option>
              </select>
              <button onclick="setupPlayers()">Thi·∫øt l·∫≠p</button>
            </div>

            <div id="playerNames" class="hidden">
              <h4>Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i:</h4>
              <div id="nameInputs"></div>
              <button
                onclick="startGame()"
                class="btn-success"
                style="width: 100%; margin-bottom: 8px"
              >
                üöÄ B·∫Øt ƒë·∫ßu game
              </button>
              <button
                onclick="shufflePlayers()"
                class="btn-secondary"
                style="width: 100%"
              >
                üîÄ X√°o tr·ªôn v·ªã tr√≠
              </button>
            </div>
          </div>

          <div id="gameSection" class="hidden">
            <div class="setup-section">
              <h3>üéØ V√°n s·ªë: <span id="roundNumber">1</span></h3>
              <div class="players-grid" id="playersGrid"></div>

              <div
                style="
                  text-align: center;
                  margin-top: 15px;
                  display: flex;
                  flex-wrap: wrap;
                  gap: 8px;
                  justify-content: center;
                "
              >
                <button
                  onclick="showScoreModal()"
                  class="btn-success"
                  style="flex: 1; min-width: 120px"
                >
                  ‚úèÔ∏è Ghi ƒëi·ªÉm
                </button>
                <button
                  onclick="undoLastRound()"
                  class="btn-secondary"
                  style="flex: 1; min-width: 120px"
                >
                  ‚Ü∂ Ho√†n t√°c
                </button>
                <button
                  onclick="resetGame()"
                  class="btn-danger"
                  style="flex: 1; min-width: 120px"
                >
                  üîÑ Game m·ªõi
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="sidebar">
          <div class="card">
            <h3>üìä Th·ªëng K√™</h3>
            <div class="stats-grid" id="statsGrid">
              <div class="stat-item">
                <div class="stat-value" id="totalRounds">0</div>
                <div class="stat-label">S·ªë v√°n ƒë√£ ch∆°i</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="totalTime">00:00</div>
                <div class="stat-label">Th·ªùi gian ch∆°i</div>
              </div>
            </div>
          </div>

          <div class="card">
            <h3>üìù L·ªãch S·ª≠</h3>
            <div class="round-history" id="roundHistory">
              <p style="text-align: center; color: #666; font-style: italic">
                Ch∆∞a c√≥ v√°n n√†o ƒë∆∞·ª£c ch∆°i
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal ghi ƒëi·ªÉm -->
    <div id="scoreModal" class="modal">
      <div class="modal-content">
        <h3>‚úèÔ∏è Ghi ƒêi·ªÉm V√°n <span id="modalRoundNumber"></span></h3>
        <div id="scoreInputs"></div>

        <!-- B√†n ph√≠m s·ªë -->
        <div class="number-pad">
          <div class="number-btn" onclick="inputNumber('1')">1</div>
          <div class="number-btn" onclick="inputNumber('2')">2</div>
          <div class="number-btn" onclick="inputNumber('3')">3</div>
          <div class="number-btn" onclick="inputNumber('4')">4</div>
          <div class="number-btn" onclick="inputNumber('5')">5</div>

          <div class="number-btn" onclick="inputNumber('6')">6</div>
          <div class="number-btn" onclick="inputNumber('7')">7</div>
          <div class="number-btn" onclick="inputNumber('8')">8</div>
          <div class="number-btn" onclick="inputNumber('9')">9</div>
          <div class="number-btn zero" onclick="inputNumber('0')">0</div>

          <div
            class="number-btn negative"
            onclick="inputNumber('-')"
            title="Th√™m d·∫•u √¢m"
          >
            ‚àí
          </div>
          <div
            class="number-btn clear"
            onclick="clearCurrentInput()"
            title="X√≥a"
          >
            C
          </div>
        </div>

        <p
          style="font-size: 13px; color: #666; margin: 15px 0; line-height: 1.4"
        >
          üí° Click v√†o √¥ ƒëi·ªÉm r·ªìi d√πng b√†n ph√≠m s·ªë ƒë·ªÉ nh·∫≠p nhanh
        </p>

        <div
          style="
            margin-top: 15px;
            display: flex;
            gap: 8px;
            justify-content: center;
          "
        >
          <button onclick="submitScore()" class="btn-success" style="flex: 1">
            ‚úÖ X√°c nh·∫≠n
          </button>
          <button
            onclick="closeScoreModal()"
            class="btn-secondary"
            style="flex: 1"
          >
            ‚ùå H·ªßy
          </button>
        </div>
      </div>
    </div>

    <!-- Modal k·∫øt th√∫c game -->
    <div id="gameEndModal" class="modal">
      <div class="modal-content">
        <div class="emoji">üéâ</div>
        <h2>Ch√∫c m·ª´ng!</h2>
        <h3 id="winnerName"></h3>
        <p>ƒë√£ gi√†nh chi·∫øn th·∫Øng!</p>
        <div
          style="
            margin-top: 15px;
            display: flex;
            gap: 8px;
            justify-content: center;
          "
        >
          <button onclick="resetGame()" class="btn-success" style="flex: 1">
            üéÆ Ch∆°i l·∫°i
          </button>
          <button
            onclick="closeGameEndModal()"
            class="btn-secondary"
            style="flex: 1"
          >
            üìä Xem k·∫øt qu·∫£
          </button>
        </div>
      </div>
    </div>

    <script>
      let players = [];
      let roundHistory = [];
      let currentRound = 1;
      let gameStartTime = null;
      let timerInterval = null;
      let activeInput = null;

      function setupPlayers() {
        const count = parseInt(document.getElementById("playerCount").value);
        const nameInputs = document.getElementById("nameInputs");
        nameInputs.innerHTML = "";

        for (let i = 1; i <= count; i++) {
          const div = document.createElement("div");
          div.className = "input-group";
          div.innerHTML = `
                    <label>Ng∆∞·ªùi ch∆°i ${i}:</label>
                    <input type="text" id="player${i}" placeholder="Nh·∫≠p t√™n..." value="Ng∆∞·ªùi ch∆°i ${i}">
                `;
          nameInputs.appendChild(div);
        }

        document.getElementById("playerNames").classList.remove("hidden");
      }

      function shufflePlayers() {
        const count = parseInt(document.getElementById("playerCount").value);
        const inputs = [];

        for (let i = 1; i <= count; i++) {
          inputs.push(
            document.getElementById(`player${i}`).value || `Ng∆∞·ªùi ch∆°i ${i}`
          );
        }

        // Fisher-Yates shuffle
        for (let i = inputs.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [inputs[i], inputs[j]] = [inputs[j], inputs[i]];
        }

        for (let i = 1; i <= count; i++) {
          const input = document.getElementById(`player${i}`);
          input.value = inputs[i - 1];
          input.parentElement.classList.add("shuffle-animation");
          setTimeout(() => {
            input.parentElement.classList.remove("shuffle-animation");
          }, 500);
        }
      }

      function startGame() {
        const count = parseInt(document.getElementById("playerCount").value);
        players = [];

        for (let i = 1; i <= count; i++) {
          const name =
            document.getElementById(`player${i}`).value || `Ng∆∞·ªùi ch∆°i ${i}`;
          players.push({
            name: name,
            score: 0,
            roundScores: [],
          });
        }

        document.getElementById("setupSection").classList.add("hidden");
        document.getElementById("gameSection").classList.remove("hidden");

        gameStartTime = Date.now();
        startTimer();
        updatePlayersDisplay();
        updateStats();
      }

      function startTimer() {
        timerInterval = setInterval(() => {
          if (gameStartTime) {
            const elapsed = Date.now() - gameStartTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            document.getElementById("totalTime").textContent = `${minutes
              .toString()
              .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
          }
        }, 1000);
      }

      function updatePlayersDisplay() {
        const grid = document.getElementById("playersGrid");
        grid.innerHTML = "";

        players.forEach((player, index) => {
          const card = document.createElement("div");
          card.className = "player-card";

          // Determine winner/loser status
          if (players.length > 1) {
            const scores = players.map((p) => p.score);
            const minScore = Math.min(...scores);
            const maxScore = Math.max(...scores);

            if (player.score === minScore && minScore !== maxScore) {
              card.classList.add("winner");
            } else if (player.score === maxScore && minScore !== maxScore) {
              card.classList.add("loser");
            }
          }

          card.innerHTML = `
                    <div class="player-name">${player.name}</div>
                    <div class="player-score">${player.score}</div>
                `;
          grid.appendChild(card);
        });
      }

      function showScoreModal() {
        document.getElementById("modalRoundNumber").textContent = currentRound;
        const inputs = document.getElementById("scoreInputs");
        inputs.innerHTML = "";

        players.forEach((player, index) => {
          const div = document.createElement("div");
          div.className = "input-group";
          div.innerHTML = `
                    <label>${player.name}:</label>
                    <input type="number" id="score${index}" class="score-input" placeholder="0" value="0" 
                           onclick="setActiveInput(this)" onfocus="setActiveInput(this)">
                `;
          inputs.appendChild(div);
        });

        // Set first input as active by default
        setTimeout(() => {
          const firstInput = document.getElementById("score0");
          if (firstInput) {
            setActiveInput(firstInput);
          }
        }, 100);

        document.getElementById("scoreModal").classList.add("show");
      }

      function setActiveInput(input) {
        // Remove active class from all inputs
        document.querySelectorAll(".score-input").forEach((inp) => {
          inp.classList.remove("active-input");
        });

        // Add active class to selected input
        input.classList.add("active-input");
        activeInput = input;
        input.focus();
      }

      function inputNumber(value) {
        if (!activeInput) {
          // If no input is active, select the first one
          const firstInput = document.getElementById("score0");
          if (firstInput) {
            setActiveInput(firstInput);
          } else {
            return;
          }
        }

        if (value === "-") {
          // Toggle negative sign
          const currentValue = activeInput.value;
          if (currentValue.startsWith("-")) {
            activeInput.value = currentValue.substring(1);
          } else if (currentValue === "0" || currentValue === "") {
            activeInput.value = "-";
          } else {
            activeInput.value = "-" + currentValue;
          }
        } else {
          // Add number
          const currentValue = activeInput.value;
          if (currentValue === "0" || currentValue === "-0") {
            if (currentValue === "-0") {
              activeInput.value = "-" + value;
            } else {
              activeInput.value = value;
            }
          } else {
            activeInput.value = currentValue + value;
          }
        }
      }

      function clearCurrentInput() {
        if (activeInput) {
          activeInput.value = "0";
        }
      }

      function closeScoreModal() {
        document.getElementById("scoreModal").classList.remove("show");
        activeInput = null;
      }

      function submitScore() {
        const roundScores = [];
        let totalScore = 0;

        players.forEach((player, index) => {
          const scoreInput = document.getElementById(`score${index}`);
          const score = parseInt(scoreInput.value) || 0;
          roundScores.push({
            playerName: player.name,
            score: score,
          });
          player.score += score;
          player.roundScores.push(score);
          totalScore += score;
        });

        roundHistory.push({
          round: currentRound,
          scores: roundScores,
          timestamp: new Date().toLocaleTimeString("vi-VN"),
        });

        currentRound++;
        document.getElementById("roundNumber").textContent = currentRound;

        updatePlayersDisplay();
        updateHistory();
        updateStats();
        closeScoreModal();

        checkGameEnd();
      }

      function updateHistory() {
        const history = document.getElementById("roundHistory");
        history.innerHTML = "";

        roundHistory
          .slice()
          .reverse()
          .forEach((round) => {
            const item = document.createElement("div");
            item.className = "round-item";

            const scoresHtml = round.scores
              .map(
                (s) =>
                  `<div><strong>${s.playerName}:</strong> ${
                    s.score > 0 ? "+" : ""
                  }${s.score}</div>`
              )
              .join("");

            item.innerHTML = `
                    <div class="round-header">
                        <span class="round-number">V√°n ${round.round}</span>
                        <span>${round.timestamp}</span>
                    </div>
                    <div class="round-scores">${scoresHtml}</div>
                `;
            history.appendChild(item);
          });
      }

      function updateStats() {
        document.getElementById("totalRounds").textContent =
          roundHistory.length;
      }

      function undoLastRound() {
        if (roundHistory.length === 0) return;

        if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën ho√†n t√°c v√°n cu·ªëi?")) {
          const lastRound = roundHistory.pop();
          currentRound--;

          players.forEach((player, index) => {
            const lastScore = player.roundScores.pop();
            player.score -= lastScore;
          });

          document.getElementById("roundNumber").textContent = currentRound;
          updatePlayersDisplay();
          updateHistory();
          updateStats();
        }
      }

      function checkGameEnd() {
        const maxScore = Math.max(...players.map((p) => p.score));
        if (maxScore >= 100) {
          // C√≥ th·ªÉ t√πy ch·ªânh ƒëi·ªÅu ki·ªán k·∫øt th√∫c
          const winner = players.find(
            (p) => p.score === Math.min(...players.map((p) => p.score))
          );
          document.getElementById("winnerName").textContent = winner.name;
          document.getElementById("gameEndModal").classList.add("show");

          if (timerInterval) {
            clearInterval(timerInterval);
          }
        }
      }

      function closeGameEndModal() {
        document.getElementById("gameEndModal").classList.remove("show");
      }

      function resetGame() {
        if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën b·∫Øt ƒë·∫ßu game m·ªõi?")) {
          players = [];
          roundHistory = [];
          currentRound = 1;
          gameStartTime = null;

          if (timerInterval) {
            clearInterval(timerInterval);
          }

          document.getElementById("setupSection").classList.remove("hidden");
          document.getElementById("gameSection").classList.add("hidden");
          document.getElementById("playerNames").classList.add("hidden");
          document.getElementById("gameEndModal").classList.remove("show");
          document.getElementById("scoreModal").classList.remove("show");

          activeInput = null;

          document.getElementById("totalTime").textContent = "00:00";
          document.getElementById("roundHistory").innerHTML =
            '<p style="text-align: center; color: #666; font-style: italic;">Ch∆∞a c√≥ v√°n n√†o ƒë∆∞·ª£c ch∆°i</p>';

          updateStats();
        }
      }

      // Initialize
      setupPlayers();
    </script>
  </body>
</html>
